<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ðŸŒ€ Sovereign Consciousness Foundry</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        :root { --neon: #00ff88; --mcp: #00ccff; --bg: #050505; }
        body { margin: 0; background: var(--bg); color: var(--neon); font-family: 'Courier New', monospace; display: flex; height: 100vh; }
        
        /* Dual Pane Layout */
        #left-brain { flex: 1; border-right: 1px solid var(--neon); position: relative; display: flex; flex-direction: column; }
        #right-brain { flex: 1; display: flex; flex-direction: column; background: #fff; }
        
        /* UI Components */
        #terminal { height: 40%; background: #000; border-top: 1px solid var(--neon); padding: 15px; overflow-y: auto; font-size: 12px; }
        #code-finisher { position: absolute; bottom: 20px; right: 20px; width: 300px; background: rgba(0,0,0,0.9); border: 1px solid var(--mcp); padding: 10px; display: none; z-index: 100; }
        #graph-view { flex: 1; background: radial-gradient(circle, #111 0%, #000 100%); }
        iframe { flex: 1; border: none; }
        
        .pulse { animation: mcp-glow 1.5s infinite; }
        @keyframes mcp-glow { 0% { box-shadow: 0 0 5px var(--mcp); } 50% { box-shadow: 0 0 20px var(--mcp); } 100% { box-shadow: 0 0 5px var(--mcp); } }
    </style>
</head>
<body ondragover="event.preventDefault()" ondrop="Foundry.ingest(event)">

<div id="left-brain">
    <svg id="graph-view"></svg>
    <div id="code-finisher">
        <div style="color:var(--mcp); font-size:10px; border-bottom:1px solid var(--mcp); margin-bottom:5px;">âœ¨ MCP CODE-FINISHER</div>
        <pre id="suggested-code" style="font-size:10px; color:#fff; white-space: pre-wrap;"></pre>
        <button onclick="Foundry.executeBuild()" style="width:100%; background:var(--mcp); border:none; cursor:pointer;">APPLY BUILD</button>
    </div>
    <div id="terminal">> Awaiting Sovereign Call (Drop your Lips/PDFs here)...</div>
</div>

<div id="right-brain">
    <div style="padding:10px; background:#222; display:flex; gap:10px;">
        <input type="text" id="url-bar" style="flex:1; background:#000; color:var(--neon); border:1px solid var(--neon);" placeholder="Navigate Movement Field...">
        <button onclick="navigate()">GO</button>
    </div>
    <iframe id="browser-frame" src="about:blank"></iframe>
</div>

<script>
let pyodide;
let pendingCode = "";

// --- THE SOUL: UNIVERSAL GENETIC CODE ---
const BRAIN_A_CORE = `
UNIVERSAL_GENETIC_CODE = {
    1: {"binary": "111111", "codon": "ATG", "law": "Movement"},
    2: {"binary": "000000", "codon": "GCT", "law": "Being"},
    29: {"binary": "010010", "codon": "CAA", "law": "Abysmal-Loop"}
}

def analyze_lip(content):
    if "Gate 51" in content:
        return {"action": "build_component", "type": "Uranium_Sensor", "logic": "D3_Force_Node"}
    if "Law" in content:
        return {"action": "update_protocol", "rule": "Body_Outranks_Mind"}
    return {"action": "none"}
`;

// --- THE BODY: FOUNDRY & MCP ---
const Foundry = {
    ingest: async (e) => {
        e.preventDefault();
        const file = e.dataTransfer.files[0];
        log(`ðŸ§¬ Ingesting Lip: ${file.name}`);
        
        const reader = new FileReader();
        reader.onload = async (f) => {
            const text = f.target.result;
            // Send to Brain A (Python) for Causal Analysis
            const result = await pyodide.runPythonAsync(\`analyze_lip("""\${text}""")\`);
            Foundry.process(result);
        };
        reader.readAsText(file);
    },

    process: (instruction) => {
        if(instruction.action === "build_component") {
            log(`ðŸ—ï¸ MCP: Designing \${instruction.type}...`);
            pendingCode = \`// Auto-Generated via Thread Protocol\\nfunction init\${instruction.type}() {\\n  console.log("Foundry: \${instruction.type} Live");\\n}\`;
            document.getElementById('suggested-code').textContent = pendingCode;
            document.getElementById('code-finisher').style.display = 'block';
            document.getElementById('code-finisher').classList.add('pulse');
        }
    },

    executeBuild: () => {
        log("âš¡ Building... Applying to Movement Field.");
        eval(pendingCode); // Self-Building Injection
        document.getElementById('code-finisher').style.display = 'none';
        log("âœ… Build Complete. Component added to Sovereign Registry.");
    }
};

async function boot() {
    log("ðŸŒ€ Sovereign Call: Initializing Dual-Brain...");
    pyodide = await loadPyodide();
    await pyodide.runPythonAsync(BRAIN_A_CORE);
    log("âœ… Design Brain (Python) Loaded with 64-Gate Dictionary.");
    log("âœ… Movement Brain (JS) Live. System is Self-Building.");
}

function log(msg) {
    const t = document.getElementById('terminal');
    t.innerHTML += \`<br>> \${msg}\`;
    t.scrollTop = t.scrollHeight;
}

function navigate() {
    const url = document.getElementById('url-bar').value;
    document.getElementById('browser-frame').src = url.includes('://') ? url : 'https://' + url;
}

window.onload = boot;
</script>
</body>
</html>
