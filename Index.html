    <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sovereign Book-Foundry</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        :root { --neon: #00ff88; --bg: #050505; }
        body { margin: 0; background: var(--bg); color: var(--neon); font-family: monospace; display: flex; height: 100vh; overflow: hidden; }
        #graph-view { flex: 1.5; position: relative; border-right: 1px solid #222; }
        #interface { flex: 1; display: flex; flex-direction: column; background: #0a0a0a; padding: 20px; }
        #terminal { flex: 1; background: #000; padding: 10px; overflow-y: auto; font-size: 11px; border: 1px solid #222; margin-bottom: 10px; color: #fff; }
        .drop-zone { height: 100px; border: 2px dashed #00ccff; display: flex; align-items: center; justify-content: center; text-align: center; margin-bottom: 15px; cursor: pointer; color: #00ccff; }
        input { background: #000; border: 1px solid var(--neon); color: var(--neon); padding: 12px; outline: none; width: calc(100% - 26px); }
        .btn-row { display: flex; gap: 10px; margin-bottom: 10px; }
        button { background: none; border: 1px solid var(--neon); color: var(--neon); padding: 5px; cursor: pointer; flex: 1; font-size: 10px; }
    </style>
</head>
<body>

<div id="graph-view">
    <svg id="canvas" width="100%" height="100%"></svg>
</div>

<div id="interface">
    <div class="btn-row">
        <button onclick="System.goBack()">‚è™ BACK</button>
        <button onclick="System.evolve()">üíæ EVOLVE</button>
    </div>
    
    <div class="drop-zone" id="drop-zone" ondragover="event.preventDefault()" ondrop="System.ingest(event)">
        DRAG BOOKS (PDF/EPUB) OR BRAIN (.py) HERE
    </div>

    <div id="terminal">> System Ready. Feed me a book to calculate resonance...</div>
    
    <input type="text" id="mcp-input" placeholder="Ask to calculate or summarize books..." onkeypress="if(event.key==='Enter') System.chat()">
</div>

<script>
let pyodide;
let nodes = [{id: "CORE", color: "#00ccff", size: 12}];
let links = [];

const System = {
    async boot() {
        this.log("Initializing Book-Parsing Kernel...");
        pyodide = await loadPyodide();
        // Pre-load math and logic libraries in Python
        await pyodide.runPythonAsync("import math\ndef calc(x): return math.sqrt(x)");
        this.initGraph();
        this.log("‚úÖ Dual-Brain Online. Ready to Parse & Calculate.");
    },

    async ingest(e) {
        e.preventDefault();
        const files = e.dataTransfer.files;
        for (let file of files) {
            this.log(`üìñ Opening Book: ${file.name}`);
            
            // Visual Node Creation
            const bookId = file.name;
            nodes.push({id: bookId, color: "#ffcc00", size: 8});
            links.push({source: "CORE", target: bookId});
            
            // Trigger Hugging Face Book Analysis (Conceptual)
            this.log("üì° Sending to Hugging Face for Deep Parsing...");
            this.render();
        }
    },

    async chat() {
        const input = document.getElementById('mcp-input');
        const val = input.value;
        this.log(`üë§: ${val}`);

        // THE CALCULATION PIECE
        if(val.includes("calc")) {
            const res = await pyodide.runPythonAsync(`calc(64)`); // Example math
            this.log(`üß† CALCULATION: ${res}`);
        } else {
            this.log(`üß† MCP: Analyzing book data for resonance...`);
        }
        
        // Add a "Thought Node"
        const tId = "Data-" + Date.now();
        nodes.push({id: tId, color: "#fff", size: 4});
        links.push({source: "CORE", target: tId});
        this.render();
        input.value = '';
    },

    log(m) {
        const t = document.getElementById('terminal');
        t.innerHTML += `<div>> ${m}</div>`;
        t.scrollTop = t.scrollHeight;
    },

    initGraph() { this.svg = d3.select("#canvas"); this.render(); },

    render() {
        const width = document.getElementById('graph-view').clientWidth;
        const height = document.getElementById('graph-view').clientHeight;
        this.svg.selectAll("*").remove();
        const sim = d3.forceSimulation(nodes)
            .force("link", d3.forceLink(links).id(d => d.id).distance(100))
            .force("charge", d3.forceManyBody().strength(-200))
            .force("center", d3.forceCenter(width / 2, height / 2));
        const link = this.svg.append("g").selectAll("line").data(links).enter().append("line").attr("stroke", "#333");
        const node = this.svg.append("g").selectAll("circle").data(nodes).enter().append("circle")
            .attr("r", d => d.size).attr("fill", d => d.color);
        sim.on("tick", () => {
            link.attr("x1", d => d.source.x).attr("y1", d => d.source.y).attr("x2", d => d.target.x).attr("y2", d => d.target.y);
            node.attr("cx", d => d.x).attr("cy", d => d.y);
        });
    }
};

window.onload = () => System.boot();
</script>
</body>
</html>

